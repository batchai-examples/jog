package grok_vjeantet

import (
	"testing"
)

func TestBroHTTP(t *testing.T) {
	testCases := []struct {
		input    string
		expected map[string]interface{}
	}{
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 GET example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "GET",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 POST example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 404 Not Found "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "POST",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "404",
				"status_msg":        "Not Found",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 PUT example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 201 Created "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "PUT",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "201",
				"status_msg":        "Created",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 DELETE example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 204 No Content "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "DELETE",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "204",
				"status_msg":        "No Content",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 HEAD example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "HEAD",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 OPTIONS example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "OPTIONS",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 PATCH example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "PATCH",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 TRACE example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "TRACE",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 CONNECT example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "CONNECT",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 OPTIONS example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "OPTIONS",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 GET example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "GET",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 POST example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "POST",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 PUT example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "PUT",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 DELETE example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "DELETE",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 HEAD example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048 200 OK "" "" "" "" "" "" "" "" "" "" ""`,
			expected: map[string]interface{}{
				"ts":                float64(1609459200),
				"uid":               "1234567890",
				"orig_h":            "192.168.1.1",
				"orig_p":            int64(80),
				"resp_h":            "192.168.1.2",
				"resp_p":            int64(80),
				"trans_depth":       int64(1),
				"method":            "HEAD",
				"domain":            "example.com",
				"uri":               "/path",
				"referrer":          "",
				"user_agent":        "Mozilla/5.0",
				"request_body_len":  float64(1024),
				"response_body_len": float64(2048),
				"status_code":       "200",
				"status_msg":        "OK",
				"info_code":         "",
				"info_msg":          "",
				"filename":          "",
				"bro_tags":          "",
				"username":          "",
				"password":          "",
				"proxied":           "",
				"orig_fuids":        "",
				"orig_mime_types":   "",
				"resp_fuids":        "",
				"resp_mime_types":   "",
			},
		},
		{
			input: `1609459200 1234567890 192.168.1.1 80 192.168.1.2 80 1 TRACE example.com /path HTTP/1.1 "" Mozilla/5.0 1024 2048
